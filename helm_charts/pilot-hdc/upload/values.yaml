appConfig:
  env: staging
  port: 5079

deploymentAnnotations:
  "sidecar.jaegertracing.io/inject": "true"

image:
  repository: docker-registry.ebrains.eu/hdc-services-image/upload
  # tag: set by Terraform via var.upload_app_version
  pullPolicy: IfNotPresent

fullnameOverride: upload

container:
  port: 5079

service:
  type: ClusterIP
  port: 5079

extraEnv:
  HOST: "0.0.0.0"

  namespace: "greenroom"

  ROOT_PATH: "/tmp"
  CORE_ZONE_LABEL: "Core"
  GREEN_ZONE_LABEL: "Greenroom"

  DATAOPS_SERVICE: "http://dataops.utility:5063"
  METADATA_SERVICE: "http://metadata.utility:5066"
  PROJECT_SERVICE: "http://project.utility:5064"

  S3_INTERNAL: "minio.minio:9000"
  S3_INTERNAL_HTTPS: "False"
  S3_PUBLIC: "minio-api.${EXTERNAL_IP}"
  S3_PUBLIC_HTTPS: "TRUE"

  REDIS_HOST: "redis-master.redis"
  REDIS_PORT: "6379"
  REDIS_DB: "0"

  KAFKA_URL: "kafka.utility.svc.cluster.local:9092"
  KAFKA_ACTIVITY_TOPIC: "metadata.items.activity"

extraEnvYaml:
  - name: REDIS_PASSWORD
    valueFrom:
      secretKeyRef:
        name: redis
        key: REDIS_PASSWORD
  - name: S3_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        name: minio-credential
        key: MINIO_ACCESS_KEY
  - name: S3_SECRET_KEY
    valueFrom:
      secretKeyRef:
        name: minio-credential
        key: MINIO_SECRET_KEY

resources:
  requests:
    cpu: "150m"
    memory: 150Mi
  limits:
    cpu: "300m"
    memory: 300Mi

readinessProbe:
  failureThreshold: 3
  initialDelaySeconds: 5
  periodSeconds: 10
  successThreshold: 1
  tcpSocket:
    port: 5079

livenessProbe:
  failureThreshold: 3
  httpGet:
    path: /v1/health
    port: 5079
    scheme: HTTP
  periodSeconds: 10
  successThreshold: 1
  timeoutSeconds: 3

replicaCount: 1
